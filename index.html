<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧭 Starter</title>
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['MiSans', 'system-ui', 'sans-serif'], // 添加自定义字体
                    },
                }
            }
        }
    </script>
    
    <style>
        /* 定义自定义字体 */
        @font-face {
            font-family: 'MiSans';
            src: url('/assets/font/MiSans-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap; /* 字体加载策略：先显示备用字体，加载完成后替换 */
        }
        
        /* 基础样式 */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            /* 禁止文本选择 */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            /* 添加过渡效果 */
            transition: backdrop-filter 0.5s ease, filter 0.5s ease;
            font-family: 'MiSans', system-ui, sans-serif; /* 应用自定义字体 */
        }
        
        /* 主要内容容器 - 新增 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center; /* 垂直居中 */
            align-items: center; /* 水平居中 */
            width: 100%;
            padding: 2rem 0; /* 增加上下内边距 */
            margin-top: 5vh; /* 向下移动 */
        }
        
        /* 允许输入框内文本选择 */
        input, textarea, [contenteditable] {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* 搜索框容器 */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.7); /* 半透明白色背景 */
            backdrop-filter: blur(5px); /* 背景模糊效果 */
            border-radius: 12px; /* 圆角 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-top: 2rem; /* 增加与标题的间距 */
        }
        
        /* 搜索输入框 */
        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 80px;
            border-radius: 12px;
            border: none;
            font-size: 1.1rem;
            background-color: transparent; /* 透明背景 */
            transition: all 0.3s ease;
            font-family: 'MiSans', system-ui, sans-serif; /* 输入框应用自定义字体 */
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
        }
        
        /* 搜索引擎选择器 */
        .engine-selector {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 70px;
            padding: 0 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid rgba(226, 232, 240, 0.5); /* 半透明边框 */
            background-color: rgba(248, 250, 252, 0.5); /* 半透明背景 */
            border-radius: 12px 0 0 12px;
            cursor: pointer;
        }
        
        .engine-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }
        
        /* 搜索按钮 */
        .search-button {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 50px;
            background-color: rgba(59, 130, 246, 0.7); /* 半透明蓝色 */
            color: white;
            border: none;
            border-radius: 0 12px 12px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .search-button:hover {
            background-color: rgba(37, 99, 235, 0.9); /* 半透明深蓝色 */
        }
        
        /* 下拉框样式 - 半透明背景 */
        .engine-dropdown {
            position: absolute;
            left: 0;
            top: calc(100% + 5px);
            width: 200px;
            max-height: 200px;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.9); /* 半透明白色背景 */
            backdrop-filter: blur(5px); /* 背景模糊效果 */
            border-radius: 12px; /* 四个角都是圆角 */
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            padding: 0.5rem 0;
            z-index: 1000; /* 确保高于其他元素 */
            display: none;
            scrollbar-width: thin;
            scrollbar-color: rgba(203, 213, 225, 0.7) rgba(241, 245, 249, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1); /* 添加半透明边框 */
        }
        
        .engine-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease-out forwards;
        }
        
        .engine-option {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            width: 100%;
            z-index: 9999;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-family: 'MiSans', system-ui, sans-serif; /* 下拉选项应用自定义字体 */
        }
        
        .engine-option:hover {
            background-color: rgba(241, 245, 249, 0.7); /* 半透明悬停背景 */
        }
        
        .engine-option.active {
            background-color: rgba(239, 246, 255, 0.7); /* 半透明选中背景 */
            color: #2563eb;
            font-weight: 500;
        }
        
        .engine-option .engine-icon {
            margin-right: 0.75rem;
        }
        
        .checkmark {
            margin-left: auto;
            display: none;
        }
        
        .engine-option.active .checkmark {
            display: block;
        }
        
        /* 加载状态 */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: #3B82F6;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* 添加模糊效果的类 */
        .blur-background {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            /* 如果背景是图片元素而不是body的背景，可以添加这个 */
            /* filter: blur(5px); */
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body id="page-body" class="animate-fade-in">
    <!-- 主要内容容器 - 新增 -->
    <div class="main-content">
        <div class="container max-w-2xl w-full mx-auto text-center">
            <h1 id="main-title" class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-2"></h1>
            <p id="sub-title" class="text-lg mb-8"></p>
        </div>
        
        <!-- 搜索区域 -->
        <div class="search-container w-full max-w-2xl mx-auto">
            <!-- 搜索引擎选择器 -->
            <div class="engine-selector" id="engine-selector">
                <img src="" alt="搜索引擎图标" class="engine-icon" id="current-engine-icon">
            </div>
            
            <!-- 搜索输入框 -->
            <input 
                type="text" 
                id="search-input" 
                class="search-input" 
                placeholder="输入搜索内容..."
            >
            
            <!-- 搜索按钮 -->
            <button type="button" class="search-button" id="search-button">
                <i class="fa fa-search"></i>
            </button>
            
            <!-- 搜索引擎下拉框 -->
            <div class="engine-dropdown" id="engine-dropdown">
                <!-- 选项将通过JS动态生成 -->
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="text-center text-gray-600 text-sm mt-8">
        <p>© 2023 快速搜索起始页</p>
    </footer>

<script>
        // 全局变量
        let config = null;
        let currentEngine = null;
        let hitokotoText = '加载中...';
        
        // DOM元素
        const pageBody = document.getElementById('page-body');
        const mainTitle = document.getElementById('main-title');
        const subTitle = document.getElementById('sub-title');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const engineSelector = document.getElementById('engine-selector');
        const currentEngineIcon = document.getElementById('current-engine-icon');
        const engineDropdown = document.getElementById('engine-dropdown');
        
        // 禁止全选功能
        function disableSelection(e) {
            // 如果选中的不是输入框或可编辑元素
            if (!e.target.matches('input, textarea, [contenteditable]')) {
                e.preventDefault();
                return false;
            }
        }
        
        // 加载配置文件
        async function loadConfig() {
            try {
                const response = await fetch('config.json');
                if (!response.ok) {
                    throw new Error('配置文件加载失败');
                }
                config = await response.json();
                return true;
            } catch (error) {
                console.error('加载配置文件出错:', error);
                mainTitle.innerHTML = '<span style="color: #dc2626;">配置文件加载失败</span>';
                subTitle.textContent = '请检查config.json是否存在且格式正确';
                return false;
            }
        }
        
        // 初始化页面背景
        function initBackground() {
            if (config.backgroundImage) {
                pageBody.style.backgroundImage = `url(${config.backgroundImage})`;
                // 添加背景遮罩提高文字可读性
                const overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.right = '0';
                overlay.style.bottom = '0';
                overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.4)';
                overlay.style.zIndex = '-1';
                pageBody.appendChild(overlay);
            } else {
                pageBody.style.backgroundColor = '#f1f5f9';
            }
        }
        
        // 设置标题样式
        function setupTitles() {
            // 设置标题颜色
            if (config.mainTitleColor) {
                mainTitle.style.color = config.mainTitleColor;
            } else {
                mainTitle.style.color = '#ffffff';
            }
            
            if (config.subTitleColor) {
                subTitle.style.color = config.subTitleColor;
            } else {
                subTitle.style.color = '#e2e8f0';
            }
            
            // 初始显示
            updateTitles();
        }
        
        // 获取每日一言
        async function fetchHitokoto() {
            try {
                const response = await fetch('https://v1.hitokoto.cn/');
                const data = await response.json();
                hitokotoText = data.hitokoto + (data.from ? ` —— ${data.from}` : '');
            } catch (error) {
                hitokotoText = '获取每日一言失败';
                console.error('获取每日一言失败:', error);
            }
            updateTitles();
        }
        
        // 更新标题显示
        function updateTitles() {
            // 处理主标题
            if (config.mainTitle === '--time--') {
                const now = new Date();
                mainTitle.textContent = now.toLocaleTimeString();
            } else if (config.mainTitle === '--hitokoto--') {
                mainTitle.textContent = hitokotoText;
            } else {
                mainTitle.textContent = config.mainTitle;
            }
            
            // 处理副标题
            if (config.subTitle === '--time--') {
                const now = new Date();
                subTitle.textContent = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            } else if (config.subTitle === '--hitokoto--') {
                subTitle.textContent = hitokotoText;
            } else {
                subTitle.textContent = config.subTitle;
            }
        }
        
        // 加载用户偏好设置
        function loadUserPreferences() {
            const savedEngine = localStorage.getItem('preferredSearchEngine');
            if (savedEngine && config.searchEngines.some(engine => engine.id === savedEngine)) {
                currentEngine = savedEngine;
            } else {
                currentEngine = config.defaultSearchEngine;
            }
            updateCurrentEngineDisplay();
        }
        
        // 保存用户偏好设置
        function saveUserPreference(engineId) {
            localStorage.setItem('preferredSearchEngine', engineId);
        }
        
        // 更新当前搜索引擎显示
        function updateCurrentEngineDisplay() {
            const engine = config.searchEngines.find(e => e.id === currentEngine);
            if (engine) {
                currentEngineIcon.src = engine.icon;
                currentEngineIcon.alt = `${engine.name}图标`;
            }
        }
        
        // 渲染搜索引擎下拉选项
        function renderEngineOptions() {
            engineDropdown.innerHTML = '';
            
            config.searchEngines.forEach(engine => {
                const isActive = engine.id === currentEngine;
                
                const option = document.createElement('button');
                option.className = `engine-option ${isActive ? 'active' : ''}`;
                option.setAttribute('data-engine', engine.id);
                
                option.innerHTML = `
                    <img src="${engine.icon}" class="engine-icon" alt="${engine.name}图标">
                    <span>${engine.name}</span>
                    <i class="fa fa-check checkmark"></i>
                `;
                
                option.addEventListener('click', () => {
                    currentEngine = engine.id;
                    saveUserPreference(currentEngine);
                    renderEngineOptions(); // 重新渲染以更新选中状态
                    updateCurrentEngineDisplay();
                    toggleDropdown();
                    searchInput.focus();
                });
                
                engineDropdown.appendChild(option);
            });
        }
        
        // 切换下拉框显示状态
        function toggleDropdown() {
            engineDropdown.classList.toggle('active');
        }
        
        // 关闭下拉框
        function closeDropdown() {
            if (engineDropdown.classList.contains('active')) {
                engineDropdown.classList.remove('active');
            }
        }
        
        // 执行搜索
        function performSearch() {
            const query = searchInput.value.trim();
            if (query) {
                const engine = config.searchEngines.find(e => e.id === currentEngine);
                if (engine) {
                    const searchUrl = engine.url.replace('%search', encodeURIComponent(query));
                    window.open(searchUrl, '_blank');
                }
            }
        }
        
        // 处理输入框内容变化
        function handleInputChange() {
            if (searchInput.value.trim() !== '') {
                // 输入框有内容时添加模糊效果
                pageBody.classList.add('blur-background');
            } else {
                // 输入框为空时移除模糊效果
                pageBody.classList.remove('blur-background');
            }
        }
        
        // 初始化事件监听
        function initEventListeners() {
            // 搜索引擎选择器点击事件
            engineSelector.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDropdown();
            });
            
            // 搜索按钮点击事件
            searchButton.addEventListener('click', performSearch);
            
            // 搜索框回车事件
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // 输入框内容变化事件
            searchInput.addEventListener('input', handleInputChange);
            
            // 点击页面其他地方关闭下拉框
            document.addEventListener('click', closeDropdown);
            
            // 阻止下拉框内部点击事件冒泡
            engineDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // 键盘导航支持
            document.addEventListener('keydown', (e) => {
                // ESC键关闭下拉框并清空输入
                if (e.key === 'Escape') {
                    closeDropdown();
                    searchInput.focus();
                }
                
                // 向下箭头打开下拉框
                if (e.key === 'ArrowDown' && document.activeElement === searchInput) {
                    e.preventDefault();
                    toggleDropdown();
                    // 聚焦第一个选项
                    const firstOption = engineDropdown.querySelector('.engine-option');
                    if (firstOption) firstOption.focus();
                }
            });
            
            // 禁止选择文本
            document.addEventListener('selectstart', disableSelection);
            document.addEventListener('mousedown', disableSelection);
        }
        
        // 初始化页面
        async function init() {
            // 显示加载状态
            mainTitle.innerHTML = '<span class="loading"></span>';
            subTitle.textContent = '加载中...';
            
            // 加载配置
            const configLoaded = await loadConfig();
            if (!configLoaded) return;
            
            // 初始化背景
            initBackground();
            
            // 设置标题
            setupTitles();
            
            // 加载每日一言（如果需要）
            if (config.mainTitle === '--hitokoto--' || config.subTitle === '--hitokoto--') {
                await fetchHitokoto();
            }
            
            // 时间更新定时器
            if (config.mainTitle === '--time--' || config.subTitle === '--time--') {
                setInterval(updateTitles, 1000);
            }
            
            // 初始化搜索引擎
            loadUserPreferences();
            renderEngineOptions();
            
            // 初始化事件监听
            initEventListeners();
            
            // 自动聚焦搜索框
            searchInput.focus();
            
            // 初始检查输入框状态
            handleInputChange();
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
