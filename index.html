<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§­ Starter</title>
    <!-- å¼•å…¥Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“ -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#6366F1',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['MiSans', 'system-ui', 'sans-serif'], // æ·»åŠ è‡ªå®šä¹‰å­—ä½“
                    },
                }
            }
        }
    </script>
    
    <style>
        /* å®šä¹‰è‡ªå®šä¹‰å­—ä½“ */
        @font-face {
            font-family: 'MiSans';
            src: url('/assets/font/MiSans-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap; /* å­—ä½“åŠ è½½ç­–ç•¥ï¼šå…ˆæ˜¾ç¤ºå¤‡ç”¨å­—ä½“ï¼ŒåŠ è½½å®Œæˆåæ›¿æ¢ */
        }
        
        /* åŸºç¡€æ ·å¼ */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            /* ç¦æ­¢æ–‡æœ¬é€‰æ‹© */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
            transition: backdrop-filter 0.5s ease, filter 0.5s ease;
            font-family: 'MiSans', system-ui, sans-serif; /* åº”ç”¨è‡ªå®šä¹‰å­—ä½“ */
        }
        
        /* ä¸»è¦å†…å®¹å®¹å™¨ - æ–°å¢ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center; /* å‚ç›´å±…ä¸­ */
            align-items: center; /* æ°´å¹³å±…ä¸­ */
            width: 100%;
            padding: 2rem 0; /* å¢åŠ ä¸Šä¸‹å†…è¾¹è· */
            margin-top: 5vh; /* å‘ä¸‹ç§»åŠ¨ */
        }
        
        /* å…è®¸è¾“å…¥æ¡†å†…æ–‡æœ¬é€‰æ‹© */
        input, textarea, [contenteditable] {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* æœç´¢æ¡†å®¹å™¨ */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            background-color: rgba(255, 255, 255, 0.7); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px); /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            border-radius: 12px; /* åœ†è§’ */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-top: 2rem; /* å¢åŠ ä¸æ ‡é¢˜çš„é—´è· */
        }
        
        /* æœç´¢è¾“å…¥æ¡† */
        .search-input {
            width: 100%;
            padding: 1rem 1rem 1rem 80px;
            border-radius: 12px;
            border: none;
            font-size: 1.1rem;
            background-color: transparent; /* é€æ˜èƒŒæ™¯ */
            transition: all 0.3s ease;
            font-family: 'MiSans', system-ui, sans-serif; /* è¾“å…¥æ¡†åº”ç”¨è‡ªå®šä¹‰å­—ä½“ */
        }
        
        .search-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25);
        }
        
        /* æœç´¢å¼•æ“é€‰æ‹©å™¨ */
        .engine-selector {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 70px;
            padding: 0 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid rgba(226, 232, 240, 0.5); /* åŠé€æ˜è¾¹æ¡† */
            background-color: rgba(248, 250, 252, 0.5); /* åŠé€æ˜èƒŒæ™¯ */
            border-radius: 12px 0 0 12px;
            cursor: pointer;
        }
        
        .engine-icon {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }
        
        /* æœç´¢æŒ‰é’® */
        .search-button {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 50px;
            background-color: rgba(59, 130, 246, 0.7); /* åŠé€æ˜è“è‰² */
            color: white;
            border: none;
            border-radius: 0 12px 12px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .search-button:hover {
            background-color: rgba(37, 99, 235, 0.9); /* åŠé€æ˜æ·±è“è‰² */
        }
        
        /* ä¸‹æ‹‰æ¡†æ ·å¼ - åŠé€æ˜èƒŒæ™¯ */
        .engine-dropdown {
            position: absolute;
            left: 0;
            top: calc(100% + 5px);
            width: 200px;
            max-height: 200px;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.9); /* åŠé€æ˜ç™½è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px); /* èƒŒæ™¯æ¨¡ç³Šæ•ˆæœ */
            border-radius: 12px; /* å››ä¸ªè§’éƒ½æ˜¯åœ†è§’ */
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            padding: 0.5rem 0;
            z-index: 1000; /* ç¡®ä¿é«˜äºå…¶ä»–å…ƒç´  */
            display: none;
            scrollbar-width: thin;
            scrollbar-color: rgba(203, 213, 225, 0.7) rgba(241, 245, 249, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1); /* æ·»åŠ åŠé€æ˜è¾¹æ¡† */
        }
        
        .engine-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease-out forwards;
        }
        
        .engine-option {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            width: 100%;
            z-index: 9999;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-family: 'MiSans', system-ui, sans-serif; /* ä¸‹æ‹‰é€‰é¡¹åº”ç”¨è‡ªå®šä¹‰å­—ä½“ */
        }
        
        .engine-option:hover {
            background-color: rgba(241, 245, 249, 0.7); /* åŠé€æ˜æ‚¬åœèƒŒæ™¯ */
        }
        
        .engine-option.active {
            background-color: rgba(239, 246, 255, 0.7); /* åŠé€æ˜é€‰ä¸­èƒŒæ™¯ */
            color: #2563eb;
            font-weight: 500;
        }
        
        .engine-option .engine-icon {
            margin-right: 0.75rem;
        }
        
        .checkmark {
            margin-left: auto;
            display: none;
        }
        
        .engine-option.active .checkmark {
            display: block;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0,0,0,.1);
            border-radius: 50%;
            border-top-color: #3B82F6;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* æ·»åŠ æ¨¡ç³Šæ•ˆæœçš„ç±» */
        .blur-background {
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            /* å¦‚æœèƒŒæ™¯æ˜¯å›¾ç‰‡å…ƒç´ è€Œä¸æ˜¯bodyçš„èƒŒæ™¯ï¼Œå¯ä»¥æ·»åŠ è¿™ä¸ª */
            /* filter: blur(5px); */
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body id="page-body" class="animate-fade-in">
    <!-- ä¸»è¦å†…å®¹å®¹å™¨ - æ–°å¢ -->
    <div class="main-content">
        <div class="container max-w-2xl w-full mx-auto text-center">
            <h1 id="main-title" class="text-[clamp(2rem,5vw,3.5rem)] font-bold mb-2"></h1>
            <p id="sub-title" class="text-lg mb-8"></p>
        </div>
        
        <!-- æœç´¢åŒºåŸŸ -->
        <div class="search-container w-full max-w-2xl mx-auto">
            <!-- æœç´¢å¼•æ“é€‰æ‹©å™¨ -->
            <div class="engine-selector" id="engine-selector">
                <img src="" alt="æœç´¢å¼•æ“å›¾æ ‡" class="engine-icon" id="current-engine-icon">
            </div>
            
            <!-- æœç´¢è¾“å…¥æ¡† -->
            <input 
                type="text" 
                id="search-input" 
                class="search-input" 
                placeholder="è¾“å…¥æœç´¢å†…å®¹..."
            >
            
            <!-- æœç´¢æŒ‰é’® -->
            <button type="button" class="search-button" id="search-button">
                <i class="fa fa-search"></i>
            </button>
            
            <!-- æœç´¢å¼•æ“ä¸‹æ‹‰æ¡† -->
            <div class="engine-dropdown" id="engine-dropdown">
                <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="text-center text-gray-600 text-sm mt-8">
        <p>Â© 2023 å¿«é€Ÿæœç´¢èµ·å§‹é¡µ</p>
    </footer>

<script>
        // å…¨å±€å˜é‡
        let config = null;
        let currentEngine = null;
        let hitokotoText = 'åŠ è½½ä¸­...';
        
        // DOMå…ƒç´ 
        const pageBody = document.getElementById('page-body');
        const mainTitle = document.getElementById('main-title');
        const subTitle = document.getElementById('sub-title');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const engineSelector = document.getElementById('engine-selector');
        const currentEngineIcon = document.getElementById('current-engine-icon');
        const engineDropdown = document.getElementById('engine-dropdown');
        
        // ç¦æ­¢å…¨é€‰åŠŸèƒ½
        function disableSelection(e) {
            // å¦‚æœé€‰ä¸­çš„ä¸æ˜¯è¾“å…¥æ¡†æˆ–å¯ç¼–è¾‘å…ƒç´ 
            if (!e.target.matches('input, textarea, [contenteditable]')) {
                e.preventDefault();
                return false;
            }
        }
        
        // åŠ è½½é…ç½®æ–‡ä»¶
        async function loadConfig() {
            try {
                const response = await fetch('config.json');
                if (!response.ok) {
                    throw new Error('é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥');
                }
                config = await response.json();
                return true;
            } catch (error) {
                console.error('åŠ è½½é…ç½®æ–‡ä»¶å‡ºé”™:', error);
                mainTitle.innerHTML = '<span style="color: #dc2626;">é…ç½®æ–‡ä»¶åŠ è½½å¤±è´¥</span>';
                subTitle.textContent = 'è¯·æ£€æŸ¥config.jsonæ˜¯å¦å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®';
                return false;
            }
        }
        
        // åˆå§‹åŒ–é¡µé¢èƒŒæ™¯
        function initBackground() {
            if (config.backgroundImage) {
                pageBody.style.backgroundImage = `url(${config.backgroundImage})`;
                // æ·»åŠ èƒŒæ™¯é®ç½©æé«˜æ–‡å­—å¯è¯»æ€§
                const overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.top = '0';
                overlay.style.left = '0';
                overlay.style.right = '0';
                overlay.style.bottom = '0';
                overlay.style.backgroundColor = 'rgba(0, 0, 0, 0.4)';
                overlay.style.zIndex = '-1';
                pageBody.appendChild(overlay);
            } else {
                pageBody.style.backgroundColor = '#f1f5f9';
            }
        }
        
        // è®¾ç½®æ ‡é¢˜æ ·å¼
        function setupTitles() {
            // è®¾ç½®æ ‡é¢˜é¢œè‰²
            if (config.mainTitleColor) {
                mainTitle.style.color = config.mainTitleColor;
            } else {
                mainTitle.style.color = '#ffffff';
            }
            
            if (config.subTitleColor) {
                subTitle.style.color = config.subTitleColor;
            } else {
                subTitle.style.color = '#e2e8f0';
            }
            
            // åˆå§‹æ˜¾ç¤º
            updateTitles();
        }
        
        // è·å–æ¯æ—¥ä¸€è¨€
        async function fetchHitokoto() {
            try {
                const response = await fetch('https://v1.hitokoto.cn/');
                const data = await response.json();
                hitokotoText = data.hitokoto + (data.from ? ` â€”â€” ${data.from}` : '');
            } catch (error) {
                hitokotoText = 'è·å–æ¯æ—¥ä¸€è¨€å¤±è´¥';
                console.error('è·å–æ¯æ—¥ä¸€è¨€å¤±è´¥:', error);
            }
            updateTitles();
        }
        
        // æ›´æ–°æ ‡é¢˜æ˜¾ç¤º
        function updateTitles() {
            // å¤„ç†ä¸»æ ‡é¢˜
            if (config.mainTitle === '--time--') {
                const now = new Date();
                mainTitle.textContent = now.toLocaleTimeString();
            } else if (config.mainTitle === '--hitokoto--') {
                mainTitle.textContent = hitokotoText;
            } else {
                mainTitle.textContent = config.mainTitle;
            }
            
            // å¤„ç†å‰¯æ ‡é¢˜
            if (config.subTitle === '--time--') {
                const now = new Date();
                subTitle.textContent = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
            } else if (config.subTitle === '--hitokoto--') {
                subTitle.textContent = hitokotoText;
            } else {
                subTitle.textContent = config.subTitle;
            }
        }
        
        // åŠ è½½ç”¨æˆ·åå¥½è®¾ç½®
        function loadUserPreferences() {
            const savedEngine = localStorage.getItem('preferredSearchEngine');
            if (savedEngine && config.searchEngines.some(engine => engine.id === savedEngine)) {
                currentEngine = savedEngine;
            } else {
                currentEngine = config.defaultSearchEngine;
            }
            updateCurrentEngineDisplay();
        }
        
        // ä¿å­˜ç”¨æˆ·åå¥½è®¾ç½®
        function saveUserPreference(engineId) {
            localStorage.setItem('preferredSearchEngine', engineId);
        }
        
        // æ›´æ–°å½“å‰æœç´¢å¼•æ“æ˜¾ç¤º
        function updateCurrentEngineDisplay() {
            const engine = config.searchEngines.find(e => e.id === currentEngine);
            if (engine) {
                currentEngineIcon.src = engine.icon;
                currentEngineIcon.alt = `${engine.name}å›¾æ ‡`;
            }
        }
        
        // æ¸²æŸ“æœç´¢å¼•æ“ä¸‹æ‹‰é€‰é¡¹
        function renderEngineOptions() {
            engineDropdown.innerHTML = '';
            
            config.searchEngines.forEach(engine => {
                const isActive = engine.id === currentEngine;
                
                const option = document.createElement('button');
                option.className = `engine-option ${isActive ? 'active' : ''}`;
                option.setAttribute('data-engine', engine.id);
                
                option.innerHTML = `
                    <img src="${engine.icon}" class="engine-icon" alt="${engine.name}å›¾æ ‡">
                    <span>${engine.name}</span>
                    <i class="fa fa-check checkmark"></i>
                `;
                
                option.addEventListener('click', () => {
                    currentEngine = engine.id;
                    saveUserPreference(currentEngine);
                    renderEngineOptions(); // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°é€‰ä¸­çŠ¶æ€
                    updateCurrentEngineDisplay();
                    toggleDropdown();
                    searchInput.focus();
                });
                
                engineDropdown.appendChild(option);
            });
        }
        
        // åˆ‡æ¢ä¸‹æ‹‰æ¡†æ˜¾ç¤ºçŠ¶æ€
        function toggleDropdown() {
            engineDropdown.classList.toggle('active');
        }
        
        // å…³é—­ä¸‹æ‹‰æ¡†
        function closeDropdown() {
            if (engineDropdown.classList.contains('active')) {
                engineDropdown.classList.remove('active');
            }
        }
        
        // æ‰§è¡Œæœç´¢
        function performSearch() {
            const query = searchInput.value.trim();
            if (query) {
                const engine = config.searchEngines.find(e => e.id === currentEngine);
                if (engine) {
                    const searchUrl = engine.url.replace('%search', encodeURIComponent(query));
                    window.open(searchUrl, '_blank');
                }
            }
        }
        
        // å¤„ç†è¾“å…¥æ¡†å†…å®¹å˜åŒ–
        function handleInputChange() {
            if (searchInput.value.trim() !== '') {
                // è¾“å…¥æ¡†æœ‰å†…å®¹æ—¶æ·»åŠ æ¨¡ç³Šæ•ˆæœ
                pageBody.classList.add('blur-background');
            } else {
                // è¾“å…¥æ¡†ä¸ºç©ºæ—¶ç§»é™¤æ¨¡ç³Šæ•ˆæœ
                pageBody.classList.remove('blur-background');
            }
        }
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
        function initEventListeners() {
            // æœç´¢å¼•æ“é€‰æ‹©å™¨ç‚¹å‡»äº‹ä»¶
            engineSelector.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleDropdown();
            });
            
            // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            searchButton.addEventListener('click', performSearch);
            
            // æœç´¢æ¡†å›è½¦äº‹ä»¶
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // è¾“å…¥æ¡†å†…å®¹å˜åŒ–äº‹ä»¶
            searchInput.addEventListener('input', handleInputChange);
            
            // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ä¸‹æ‹‰æ¡†
            document.addEventListener('click', closeDropdown);
            
            // é˜»æ­¢ä¸‹æ‹‰æ¡†å†…éƒ¨ç‚¹å‡»äº‹ä»¶å†’æ³¡
            engineDropdown.addEventListener('click', (e) => {
                e.stopPropagation();
            });
            
            // é”®ç›˜å¯¼èˆªæ”¯æŒ
            document.addEventListener('keydown', (e) => {
                // ESCé”®å…³é—­ä¸‹æ‹‰æ¡†å¹¶æ¸…ç©ºè¾“å…¥
                if (e.key === 'Escape') {
                    closeDropdown();
                    searchInput.focus();
                }
                
                // å‘ä¸‹ç®­å¤´æ‰“å¼€ä¸‹æ‹‰æ¡†
                if (e.key === 'ArrowDown' && document.activeElement === searchInput) {
                    e.preventDefault();
                    toggleDropdown();
                    // èšç„¦ç¬¬ä¸€ä¸ªé€‰é¡¹
                    const firstOption = engineDropdown.querySelector('.engine-option');
                    if (firstOption) firstOption.focus();
                }
            });
            
            // ç¦æ­¢é€‰æ‹©æ–‡æœ¬
            document.addEventListener('selectstart', disableSelection);
            document.addEventListener('mousedown', disableSelection);
        }
        
        // åˆå§‹åŒ–é¡µé¢
        async function init() {
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            mainTitle.innerHTML = '<span class="loading"></span>';
            subTitle.textContent = 'åŠ è½½ä¸­...';
            
            // åŠ è½½é…ç½®
            const configLoaded = await loadConfig();
            if (!configLoaded) return;
            
            // åˆå§‹åŒ–èƒŒæ™¯
            initBackground();
            
            // è®¾ç½®æ ‡é¢˜
            setupTitles();
            
            // åŠ è½½æ¯æ—¥ä¸€è¨€ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if (config.mainTitle === '--hitokoto--' || config.subTitle === '--hitokoto--') {
                await fetchHitokoto();
            }
            
            // æ—¶é—´æ›´æ–°å®šæ—¶å™¨
            if (config.mainTitle === '--time--' || config.subTitle === '--time--') {
                setInterval(updateTitles, 1000);
            }
            
            // åˆå§‹åŒ–æœç´¢å¼•æ“
            loadUserPreferences();
            renderEngineOptions();
            
            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners();
            
            // è‡ªåŠ¨èšç„¦æœç´¢æ¡†
            searchInput.focus();
            
            // åˆå§‹æ£€æŸ¥è¾“å…¥æ¡†çŠ¶æ€
            handleInputChange();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
